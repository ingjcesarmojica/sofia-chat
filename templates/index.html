<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sofia - Asistente Virtual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            background: white;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            color: #2c3e50;
            padding: 15px 20px 10px;
            text-align: center;
            position: relative;
            flex-shrink: 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo {
            height: 35px;
            width: auto;
            max-width: 85%;
        }
        
        .avatar-container {
            margin: 0 auto 10px;
            width: 80px;
            height: 80px;
        }
        
        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #e0e0e0;
            background: #e0e0e0 url('https://bidamericas.com/tusabogados/foto.png') center/cover;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 22px;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .subtitle {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: inline-block;
            background: #f1f2f6;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            margin-top: 8px;
            color: #7f8c8d;
        }
        
        .chat-container {
            background: #f8f9fa;
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            font-size: 14px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: #3498db;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .sofia-message {
            background: white;
            color: #2c3e50;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .typing-indicator {
            display: none;
            padding: 10px 14px;
            background: white;
            border-radius: 18px;
            border: 1px solid #e0e0e0;
            width: fit-content;
            margin-bottom: 12px;
            font-style: italic;
            color: #7f8c8d;
            font-size: 13px;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: #3498db;
        }
        
        .send-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        
        .send-btn:hover {
            transform: scale(1.05);
            background: #2980b9;
        }
        
        /* Nuevo botón "Hablar con Sofia" */
        .talk-button {
            display: block;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            margin: 10px auto 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .talk-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            background: #2980b9;
        }
        
        .talk-button.listening {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Barra de navegación inferior */
        .nav-bottom {
            display: flex;
            justify-content: space-around;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 15px;
            color: #7f8c8d;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .nav-item.active {
            color: #3498db;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        /* Responsive para móviles */
        @media (max-width: 480px) {
            .header {
                padding: 15px 15px 10px;
            }
            
            .avatar-container {
                width: 70px;
                height: 70px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .subtitle {
                font-size: 13px;
            }
            
            .message {
                font-size: 13px;
                padding: 8px 12px;
            }
            
            input {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .send-btn {
                width: 40px;
                height: 40px;
            }
            
            .talk-button {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://bidamericas.com/tusabogados/logo.png" alt="Fusa Abogados" class="logo">
            </div>
            
            <div class="header-content">
                <div class="avatar-container">
                    <div class="avatar"></div>
                </div>
                <div class="header-text">
                    <h1>Sofia 💡</h1>
                    <p class="subtitle">Representante de atención al cliente</p>
                    <button class="talk-button" id="talkButton" onclick="startVoiceRecognition()">
                        🎤 Hablar con Sofia
                    </button>
                    <div class="status-indicator" id="statusIndicator">🔴 Inicializando...</div>
                </div>
            </div>
        </div>

        <div class="chat-container" id="chatBox">
            <div class="message sofia-message">
                ¡Hola! Soy Sofia, tu representante de atención al cliente. ¿En qué puedo ayudarte hoy?
            </div>
            <div class="typing-indicator" id="typingIndicator">
                Sofia está escribiendo...
            </div>
        </div>

        <div class="input-container">
            <input type="text" id="userInput" placeholder="Escribe tu mensaje..." onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">→</button>
        </div>

        <div class="nav-bottom">
            <div class="nav-item active">
                <div class="nav-icon">💬</div>
                <span>Chat</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">🎤</div>
                <span>Voz</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">📋</div>
                <span>Historial</span>
            </div>
        </div>
    </div>

    <script>
        let voiceSupported = false;
        let recognition = null;
        let selectedVoice = null;
        let voices = [];
        
        // Configuración específica de voz según la imagen
        const VOICE_SETTINGS = {
            pitch: 1.0,        // Tono de voz: 1.1
            rate: 1.0,         // Velocidad: 1.1
            volume: 1.0,
            preferredLang: 'es-US'  // Idioma: es-US (Español Estados Unidos)
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Añadir funcionalidad a la navegación inferior
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
        });

        function initializeApp() {
            checkVoiceSupport();
            loadVoices();
            updateStatus('🔍 Buscando voces disponibles...');
            
            // Mensaje de bienvenida con voz
            setTimeout(() => {
                const welcomeText = "Hola, mi nombre es Sofia. Soy tu asistente virtual con una voz latina cálida y profesional. ¿En qué puedo ayudarte hoy?";
                speakText(welcomeText);
            }, 1500);
        }

        function checkVoiceSupport() {
            voiceSupported = ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window);
            const speechSupported = 'speechSynthesis' in window;
            
            if (voiceSupported && speechSupported) {
                updateStatus('🟢 Sistema de voz activo');
            } else {
                updateStatus('🔴 Voz no compatible');
                document.getElementById('talkButton').style.display = 'none';
            }
        }
        
        function updateStatus(message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            
            if (message.includes('🟢')) {
                indicator.style.background = 'rgba(46, 204, 113, 0.2)';
                indicator.style.color = '#27ae60';
            } else if (message.includes('🔴')) {
                indicator.style.background = 'rgba(231, 76, 60, 0.2)';
                indicator.style.color = '#c0392b';
            } else {
                indicator.style.background = 'rgba(255, 193, 7, 0.2)';
                indicator.style.color = '#d35400';
            }
        }

        function loadVoices() {
            // Obtener todas las voces disponibles
            voices = speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                // Si no hay voces, esperar al evento voiceschanged
                speechSynthesis.onvoiceschanged = function() {
                    voices = speechSynthesis.getVoices();
                    selectBestVoice();
                };
                return;
            }
            
            selectBestVoice();
        }
        
        function selectBestVoice() {
            // Buscar voces en español
            const spanishVoices = voices.filter(voice => 
                voice.lang.includes('es') || voice.lang.includes('ES')
            );
            
            if (spanishVoices.length === 0) {
                updateStatus('⚠️ No hay voces en español');
                return;
            }
            
            // Priorizar es-US
            const esUSVoices = spanishVoices.filter(voice => voice.lang === 'es-US');
            
            if (esUSVoices.length > 0) {
                selectedVoice = esUSVoices[0];
                updateStatus('🟢 Voz es-US encontrada');
            } else {
                // Usar otra voz en español si no hay es-US
                selectedVoice = spanishVoices[0];
                updateStatus('⚠️ Usando voz alternativa');
            }
        }
        
        function speakText(text) {
            if (!selectedVoice) {
                console.error('No hay voz seleccionada para hablar');
                return;
            }
            
            // Detener cualquier síntesis de voz previa
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Configurar la voz seleccionada
            utterance.voice = selectedVoice;
            utterance.lang = selectedVoice.lang || 'es-US';
            utterance.pitch = VOICE_SETTINGS.pitch;
            utterance.rate = VOICE_SETTINGS.rate;
            utterance.volume = VOICE_SETTINGS.volume;
            
            utterance.onstart = function() {
                updateStatus('🎵 Reproduciendo voz...');
            };
            
            utterance.onend = function() {
                updateStatus('🟢 Voz lista');
            };
            
            utterance.onerror = function(event) {
                console.error('Error de síntesis de voz:', event);
                updateStatus('❌ Error de voz');
            };
            
            try {
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Error al hablar:', error);
                updateStatus('❌ Error al iniciar voz');
            }
        }

        function startVoiceRecognition() {
            if (!voiceSupported) {
                alert('El reconocimiento de voz no es compatible con tu navegador. Usa Chrome o Edge.');
                return;
            }

            const talkButton = document.getElementById('talkButton');
            
            if (recognition && recognition.isListening) {
                recognition.stop();
                return;
            }

            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = function() {
                talkButton.classList.add('listening');
                recognition.isListening = true;
                updateStatus('🎤 Escuchando...');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('userInput').value = transcript;
                sendMessage();
                
                talkButton.classList.remove('listening');
                recognition.isListening = false;
                updateStatus('🟢 Voz lista');
            };
            
            recognition.onerror = function(event) {
                talkButton.classList.remove('listening');
                recognition.isListening = false;
                
                if (event.error !== 'no-speech' && event.error !== 'aborted') {
                    alert('Error en reconocimiento: ' + event.error);
                    updateStatus('❌ Error de reconocimiento');
                } else {
                    updateStatus('🟢 Voz lista');
                }
            };
            
            recognition.onend = function() {
                talkButton.classList.remove('listening');
                recognition.isListening = false;
                updateStatus('🟢 Voz lista');
            };
            
            try {
                recognition.start();
                updateStatus('🎤 Iniciando reconocimiento...');
            } catch (error) {
                alert('Error al activar el micrófono: ' + error.message);
                updateStatus('❌ Error de micrófono');
            }
        }

        function addMessage(message, isUser = false) {
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message sofia-message';
            messageDiv.textContent = message;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                showTypingIndicator();
                
                // Simular respuesta inteligente
                setTimeout(() => {
                    hideTypingIndicator();
                    const response = generateResponse(message);
                    addMessage(response, false);
                    
                    // Hablar con la voz configurada
                    speakText(response);
                }, Math.random() * 1000 + 1500);
            }
        }
        
        function generateResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('hola') || message.includes('buenos') || message.includes('saludos')) {
                const greetings = [
                    "¡Hola! Es un placer saludarte. Soy Sofia y estoy aquí para ayudarte en lo que necesites.",
                    "¡Buenos días! Soy Sofia, tu asistente virtual. ¿Cómo puedo hacer que tu día sea mejor?",
                    "¡Hola! Me alegra mucho que te pongas en contacto conmigo. ¿En qué puedo asistirte hoy?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            if (message.includes('gracias') || message.includes('te agradezco')) {
                const thanks = [
                    "¡De nada! Es un placer poder ayudarte. Estoy aquí cuando me necesites.",
                    "No hay de qué agradecer. Me encanta poder asistirte en lo que requieras.",
                    "¡Con mucho gusto! Siempre es un placer ayudar a nuestros clientes."
                ];
                return thanks[Math.floor(Math.random() * thanks.length)];
            }
            
            if (message.includes('voz') || message.includes('sonido') || message.includes('hablar')) {
                return "Estoy utilizando mi voz configurada especialmente para una experiencia natural y agradable. ¿Te gusta cómo sueno?";
            }
            
            // Respuestas generales
            const generalResponses = [
                "Comprendo tu situación. Déjame analizar tu consulta para brindarte la mejor asesoría posible.",
                "Entiendo perfectamente lo que me comentas. Mi objetivo es ayudarte a resolver esto de la manera más eficiente.",
                "Te escucho con atención. Cada caso es único y merece una atención personalizada.",
                "Muchas gracias por confiar en nosotros. Estoy aquí para brindarte toda la información y apoyo que necesites."
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Cargar voces cuando el usuario interactúa por primera vez
        document.addEventListener('click', function() {
            // Solo cargar voces si no se han cargado aún
            if (voices.length === 0) {
                loadVoices();
            }
        }, { once: true });
        
        // También cargar voces cuando la página esté completamente cargada
        window.addEventListener('load', function() {
            // Dar tiempo al navegador para cargar las voces
            setTimeout(loadVoices, 1000);
        });
    </script>
</body>
</html>
